<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Code Contest Live</title>
<script src="https://code.jquery.com/jquery-2.2.4.js"></script>
<!--
<link type="text/css" rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="tinysort.js"></script>
<script src="dist/tinysort.charorder.js"></script>
-->
<style>
div#xanim span {
    transition: top 500ms;
    -webkit-transition: top 500ms;
}
.rankbox {
	/* position: absolute; */
	height: 22px;
	border-radius: 5px;
	background-color: #5b6dcd;
    color: #fff;
    padding: 4px 8px;
}
.columnbox {
	display: flex;
    justify-content: center;
    flex-direction: column;
}
</style>
</head>
<body>

<div style="border: 1px grey solid; height: 180px; width: 200px; overflow: hidden;">
<p>Live ranking</p>
<div>
	<div id="xanim" class="rankdiv" style="position: absolute;">
		<span class="rankbox">Sophia</span>
		<span class="rankbox" style="top: 35px;">France</span>
		<span class="rankbox" style="top: 70px;">Paris</span>
	</div>
	<!--	
	<div class="example" style="position: absolute;">
		<ul id="xanim" style="">
			<li style="position: absolute; top: 0px;">Sophia</li>
			<li style="position: absolute; top: 22px;">France</li>
			<li style="position: absolute; top: 44px;">Louisiane</li>
			<li style="position: absolute; top: 66px;">Marine</li>
			<li style="position: absolute; top: 88px;">Valence</li>
			<li style="position: absolute; top: 110px;">Virginie</li>
			<li style="position: absolute; top: 132px;">Boreale</li>
			<li style="position: absolute; top: 154px;">Vendredi</li>
		</ul>
	</div>
	-->
</div>
</div>

</body>
<script>

$.get("/sqlite_exec?db=.code-contest/db.sqlite&stmt=select * from submissions")
.then(data => console.log(data));

function ranksort_init() {
	var rankDiv = document.getElementById('xanim'),
		rankBoxes = rankDiv.querySelectorAll('span'),
		rankBoxHeight = rankBoxes[0].offsetHeight+8;
	
	// initial
	rankDiv.style.height = rankDiv.offsetHeight+'px';
	for (var i=0, n=rankBoxes.length; i<n; i++) {
		var rb = rankBoxes[i];
		rb.style.position = 'absolute';
		rb.style.top = i*rankBoxHeight+'px';
	}

	// sort 
	function sort(rank) {
		rankBoxes.forEach(function(elm,i) {
			setTimeout((function(elm,i){
				elm.style.top = pos[i]*rankBoxHeight+'px';
			}).bind(null,elm,i),40);
		});
	}
	return sort;
}

function shuffle(v) {
	var n = v.length;
	for (var i=0; i<n; i++) {
		var p = Math.floor(n*Math.random());
		var vtmp = v[i];
		v[i] = v[p];
		v[p] = vtmp;
	}
	return v;
}

var ranksort = ranksort_init();
var nbBoxes = document.getElementById('xanim').querySelectorAll('#xanim>span').length;
var pos = shuffle(new Array(nbBoxes).fill(null).map((x, i) =>i))
ranksort(pos);

</script>
</html>